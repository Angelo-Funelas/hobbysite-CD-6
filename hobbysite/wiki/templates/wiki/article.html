{% extends "base.html" %}

{% block title %}{{ article.title }}{% endblock %}
{% block content %}
    <div>

        <a href="{% url 'wiki:articles_list' %}">
           &larr; Back to Articles
        </a>

        {% if request.user.is_authenticated and request.user.profile == article.author %}
            <br><a href="{% url 'wiki:article_update' pk=article.pk %}">
                Edit Article
            </a>
        {% endif %}

        {% if article.header_image %}
            <div>
                <img src="{{ article.header_image.url }}" alt="{{ article.title }}"  style="max-width: 100%; height: auto;">
            </div>
        {% endif %}

        <h1>{{ article.title }}</h1>

        <p>
            <strong>Category:</strong> {{ article.category.name|default:"Uncategorized" }}<br>
            <strong>Author:</strong> {{ article.author }}
        </p>

        <p>
            Created On: {{ article.created_on|date:"F d, Y" }}<br>
            Last Updated: {{ article.updated_on|date:"F d, Y" }}
        </p>

        <div>
            {{ article.entry|linebreaks }}
        </div>

        <div>
            <h3>Read More from {{ article.category.name }}</h3>
            <ul>
                {% for related_article in related_articles %}
                    <li>
                        <a href="{% url 'wiki:article_detail' pk=related_article.pk %}">{{ related_article.title }}</a>
                    </li>
                {% empty %}
                    <li>No related articles found.</li>
                {% endfor %}
            </ul>
        </div>

        <div>
            {% if user.is_authenticated %}
                <h4>Leave a Comment</h4>
                <form method="POST">
                    {% csrf_token %}
                    {{ comment_form.as_p }}
                    <button type="submit">Submit Comment</button>
                </form>
            {% else %}
                <p>You need to <a href="{% url 'login' %}">log in</a> to leave a comment.</p>
            {% endif %}
        </div>

        <div>
            <h3>Comments</h3>

            {% for comment in comments %}
                <div>
                    <p><strong>{{ comment.author }}</strong> - {{ comment.created_on|date:"F d, Y" }}</p>
                    <p>{{ comment.entry }}</p>
                </div>
            {% empty %}
                <p>No comments yet. Be the first to comment!</p>
            {% endfor %}
        </div>
    </div>
{% endblock %}